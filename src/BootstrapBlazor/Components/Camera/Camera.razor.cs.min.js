(function(n){n.extend({bb_camera:function(t,i,r,u){var f=n(t);navigator.mediaDevices.enumerateDevices().then(function(t){var e=t.filter(function(n){return n.kind==="videoinput"});i.invokeMethodAsync("InitDevices",e).then(()=>{u&&e.length>0&&f.find('button[data-method="play"]').trigger("click")});var r=f.find("video")[0],o=f.find("canvas")[0],h=o.getContext("2d"),s;f.on("click","button[data-method]",function(){var e=n(this).attr("data-method"),t,c,u;if(e==="play"){var v=n(this).attr("data-camera"),l=f.find(".dropdown-item.active").attr("data-val"),a={video:{facingMode:v},audio:!1};l!==""&&(a.video.deviceId={exact:l});navigator.mediaDevices.getUserMedia(a).then(n=>{r.srcObject=n,r.play(),s=n.getTracks()[0],i.invokeMethodAsync("Start")}).catch(n=>{console.log(n),i.invokeMethodAsync("GetError",n.message)})}else e==="stop"?(r.pause(),r.srcObject=null,s.stop(),i.invokeMethodAsync("Stop")):e==="capture"&&(h.drawImage(r,0,0,300,200),t=o.toDataURL(),console.log(t),i.invokeMethodAsync("Capture"),c=f.find("img"),c.length===1&&c.attr("src",t),u=f.find("a.download"),u.attr("href",t),u.attr("download",(new Date).format("yyyyMMddHHmmss")+".png"),u[0].click())})})}})})(jQuery);