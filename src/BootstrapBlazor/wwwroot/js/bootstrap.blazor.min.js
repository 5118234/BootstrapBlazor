(function(n){n.extend({bb_tooltip:function(t,i,r,u,f,e){var h={html:f,sanitize:!f,title:r,placement:u,trigger:e},o=n("#"+t),s;i===""?(o.data("bs.tooltip")&&o.tooltip("dispose"),o.tooltip(h)):i==="enable"?(o.data("bs.tooltip")&&o.tooltip("dispose"),o.tooltip(h),s=o.parents("form").find(".is-invalid:first"),s.prop("nodeName")==="INPUT"?s.prop("readonly")?s.trigger("focus"):s.focus():s.prop("nodeName")==="DIV"&&s.trigger("focus")):i==="dispose"?o.data("bs.tooltip")&&o.tooltip(i):(o.data("bs.tooltip")||o.tooltip(h),o.tooltip(i))},bb_popover:function(t,i,r,u,f,e,o){var s=n("#"+t),h={html:e,sanitize:!1,title:r,content:u,placement:f,trigger:o};i===""?(s.data("bs.popover")&&s.popover("dispose"),s.popover(h)):i==="dispose"?s.data("bs.popover")&&s.popover(i):(s.data("bs.popover")||s.popover(h),s.popover(i))},bb_confirm:function(t){var r=n('[data-target="'+t+'"]'),i=n("#"+t);i.popover({toggle:"confirm",html:!0,sanitize:!1,content:r.find(".popover-body").html()});i.popover("show")},bb_modal:function(t,i){var u=n(t);if(i==="dispose")u.remove();else if(i==="init"){if(u.closest(".swal").length===0){n("body").append(u);var o=0,s=0,e=0,h=0,f={top:0,left:0},r=null;u.find(".is-draggable .modal-header").drag(function(n){o=n.clientX||n.touches[0].clientX;s=n.clientY||n.touches[0].clientY;r=this.closest(".modal-dialog");e=r.width();h=r.height();f.top=parseInt(r.css("marginTop").replace("px",""));f.left=parseInt(r.css("marginLeft").replace("px",""));r.css({marginLeft:f.left,marginTop:f.top});r.removeClass("modal-dialog-centered");r.css("width",e);this.addClass("is-drag")},function(t){var i=t.clientX||t.changedTouches[0].clientX,u=t.clientY||t.changedTouches[0].clientY;newValX=f.left+Math.ceil(i-o);newValY=f.top+Math.ceil(u-s);newValX<=0&&(newValX=0);newValY<=0&&(newValY=0);newValX+e<n(window).width()&&r!=null&&r.css({marginLeft:newValX});newValY+h<n(window).height()&&r!=null&&r.css({marginTop:newValY})},function(){this.removeClass("is-drag")})}u.on("shown.bs.modal",function(){n(document).one("keyup",function(n){if(n.key==="Escape"){var i=u.find(".modal-dialog"),t=i.data("bb_dotnet_invoker");t!=null&&t.invokeMethodAsync("Close")}})})}else u.modal(i)},bb_dialog:function(t,i,r){var u=n(t);r==="init"&&u.data("bb_dotnet_invoker",i)},bb_filter:function(t,i,r){n(t).data("bb_filter",{obj:i,method:r})},bb_table_resize:function(t){var u=t.find(".col-resizer");if(u.length>0){var f=function(t){var u=n(this),i=u.closest("th");t?i.addClass("border-resize"):i.removeClass("border-resize");var r=i.index(),f=i.closest(".table-resize").find("tbody"),e=f.find("tr").each(function(){var i=n(this.children[r]);t?i.addClass("border-resize"):i.removeClass("border-resize")});return r},i=0,e=0,r=0,o=0;u.each(function(){n(this).drag(function(u){r=f.call(this,!0);var s=t.find("table colgroup col")[r].width;i=s?parseInt(s):n(this).closest("th").width();e=n(this).closest("table").width();o=u.clientX},function(u){t.find("table colgroup").each(function(t,f){var h=n(f).find("col")[r],s=u.clientX-o;h.width=i+s;t===0&&n(f).closest("table").width(e+s)})},function(){f.call(this,!1)})})}},bb_table:function(t,i,r){var u=n(t),p=function(){u.find(".is-tips").tooltip({container:"body",title:function(){return n(this).text()}})},h=u.find(".btn-col"),w,c,s,f,e,l,o,a,v,y,b;if(!h.hasClass("init")){h.addClass("init");h.on("click",function(){var t=n(this).next();t.toggleClass("show")})}if(i==="fixTableHeader"){w=u.find(".table-fixed-header");c=u.find(".table-fixed-body");c.on("scroll",function(){var n=c.scrollLeft();w.scrollLeft(n)});if(s=u.find(".fixed-scroll"),s.length===1){for(f=s.prev();f.length===1;)if(f.hasClass("fixed-right")&&!f.hasClass("modified"))e=f.css("right"),e=e.replace("px",""),n.browser.versions.mac?e=parseFloat(e)-2+"px":n.browser.versions.mobile&&(e=parseFloat(e)-17+"px"),f.css({right:e}).addClass("modified"),f=f.prev();else break;n.browser.versions.mobile&&s.remove()}u.find(".col-resizer:last").remove();n.bb_table_resize(u)}else if(i==="init"){l=u.find(".table-cell.is-sort .table-text");o={unset:"点击升序",sortAsc:"点击降序",sortDesc:"取消排序"};l.each(function(){var i=n(this).parent().find(".fa:last"),t;i.length>0&&(t=o.unset,i.hasClass("fa-sort-asc")?t=o.sortAsc:i.hasClass("fa-sort-desc")&&(t=o.sortDesc),n(this).tooltip({container:"body",title:t}))});l.on("click",function(){var i=n(this),u=i.parent().find(".fa:last"),t="sortAsc",r,f;u.hasClass("fa-sort-asc")?t="sortDesc":u.hasClass("fa-sort-desc")&&(t="unset");r=n("#"+i.attr("aria-describedby"));r.length>0&&(f=r.find(".tooltip-inner"),f.html(o[t]),i.attr("data-original-title",o[t]))});a=u.find(".table-toolbar");v=0;a.length>0&&(v=a.height());y=function(){var s=n(this).position(),h=n(this).attr("data-field"),r=u.find('.table-filter-item[data-field="'+h+'"]'),t=n(this).closest("th"),e=t.outerWidth()+t.position().left-r.outerWidth()/2,i=0,o,f;t.hasClass("sortable")&&(i=24);t.hasClass("filterable")&&(i=i+12);o=t.closest("table").parent().scrollLeft();f=t.offset().left+t.outerWidth()-i+r.outerWidth()/2-n(window).width();i=i+o;f>0&&(e=e-f-16,$arrow=r.find(".card-arrow"),$arrow.css({left:"calc(50% - 0.5rem + "+(f+16)+"px)"}));r.css({top:s.top+v+50,left:e-i})};u.find(".filterable .fa-filter").on("click",function(){y.call(this)});p();u.children(".table-scroll").scroll(function(){u.find(".table-filter-item.show").each(function(){var t=n(this).attr("data-field"),i=u.find('.fa-filter[data-field="'+t+'"]')[0];y.call(i)})});n.bb_table_resize(u)}else{if(i==="width")return b=0,r?u.outerWidth(!0):n(window).outerWidth(!0);i==="tooltip"&&p()}},timePicker:function(t){return n(t).find(".time-spinner-item").height()},datetimePicker:function(t,i){var r=n(t),f=r.attr("data-placement")||"auto",u=r.find(".datetime-picker-input");if(i)u.popover(i);else{u.popover({toggle:"datetime-picker",placement:f,template:'<div class="popover popover-datetime" role="tooltip"><div class="arrow"><\/div><h3 class="popover-header"><\/h3><div class="popover-body"><\/div><\/div>'}).on("inserted.bs.popover",function(){var t=this.getAttribute("aria-describedby"),i;t&&(i=n("#"+t),i.find(".popover-body").append(r.find(".date-picker").removeClass("d-none")))}).on("hide.bs.popover",function(){var u=this.getAttribute("aria-describedby"),t,i;u&&(t=n("#"+u),i=t.find(".date-picker"),t.find(".popover-body").append(i.clone()),r.append(i.addClass("d-none")))});n(".datetime-picker-input-icon").on("click",function(t){if(!n(this).hasClass("disabled")){t.stopImmediatePropagation();var i=n(this).parents(".datetime-picker-bar").find(".datetime-picker-input");i.trigger("click")}});n(".disabled .cell").on("click",function(n){n.preventDefault();n.stopImmediatePropagation()})}},bb_datetimeRange:function(t,i){var r=n(t),f=r.attr("data-placement")||"auto",u=r.find(".datetime-range-bar");if(i)u.popover(i);else{u.popover({toggle:"datetime-range",placement:f,template:'<div class="popover popover-datetime-range" role="tooltip"><div class="arrow"><\/div><h3 class="popover-header"><\/h3><div class="popover-body"><\/div><\/div>'}).on("inserted.bs.popover",function(){var t=this.getAttribute("aria-describedby"),i;t&&(i=n("#"+t),i.find(".popover-body").append(r.find(".datetime-range-body").addClass("show")))}).on("hide.bs.popover",function(){var u=this.getAttribute("aria-describedby"),t,i;u&&(t=n("#"+u),i=t.find(".datetime-range-body"),t.find(".popover-body").append(i.clone()),r.append(i.removeClass("show")))});r.find(".is-clear").on("click",function(){u.popover("hide")})}},bb_tab:function(t){n(t).tab("active")},footer:function(t,i){var r=n(t),u=r.tooltip();r.on("click",function(t){t.preventDefault();n(i||window).scrollTop(0);u.tooltip("hide")})},bb_layout:function(t,i){n(".layout-header").find('[data-toggle="tooltip"]').tooltip();n(window).on("resize",function(){r()});var r=function(){var r=n(window).width();t.invokeMethodAsync(i,r)};r()},bb_scroll:function(t,i){var r=n(t),o=n(window).width()<768||navigator.userAgent.match(/Macintosh/);if(i||!o){var s=r.attr("data-hide"),u=r.attr("data-height"),e=r.attr("data-width"),f={alwaysVisible:s!=="true"};u||(u="auto");u!==""&&(f.height=u);e||(f.width=e);r.slimScroll(f)}else r.addClass("is-phone")},markdown:function(t,i){var o="bb_editor",u=n(t),f,e,r;if(i){if(r=u.data(o),r)return f=r[i](),console.log(f),f}else e=n.getUID(),u.attr("id",e),r=editormd(e,{saveHTMLToTextarea:!0,path:"/lib/"}),u.data(o,r)},bb_console_log:function(t){var u=n(t),i=u.find('[data-scroll="auto"]'),r;i.length>0&&(r=i.find(".console-window"),i.scrollTop(r.height()))},bb_multi_select:function(t,i,r){n(t).data("bb_multi_select",{obj:i,method:r})},bb_tree:function(t){var i=n(t);i.find(".tree-content").hover(function(){n(this).parent().addClass("hover")},function(){n(this).parent().removeClass("hover")})},bb_select:function(t){var i=n("#"+t),r=i.find("input.search-text");if(r.length>0)i.on("shown.bs.dropdown",function(){r.focus()})},bb_drawer:function(t,i){var r=n(t),u;i?(r.addClass("is-open"),n("body").addClass("overflow-hidden")):r.hasClass("is-open")&&(r.removeClass("is-open").addClass("is-close"),u=window.setTimeout(function(){window.clearTimeout(u);r.removeClass("is-close");n("body").removeClass("overflow-hidden")},350))}});n(function(){n(document).on("inserted.bs.tooltip",".is-invalid",function(){n("#"+n(this).attr("aria-describedby")).addClass("is-invalid")});n.fn.popover.Constructor.prototype.isWithContent=function(){var n=this.config.toggle;return["","confirm","datetime-picker","datetime-range"].indexOf(n)||this.getTitle()||this._getContent()};var t=function(t){var i=null,r=t.parents(".popover"),u;return r.length>0&&(u=r.attr("id"),i=n('[aria-describedby="'+u+'"]')),i};n(document).on("click",function(i){var o=!0,r=n(i.target),a=t(r),u,f,s,h,e,c,l;(a!=null&&(o=!1),o&&n('[data-toggle="confirm"][aria-describedby^="popover"]').popover("hide"),r.parents(".popover-datetime.show").length===0&&n(".popover-datetime.show").each(function(){var t=this.getAttribute("id"),i;t&&(i=n('[aria-describedby="'+t+'"]'),r.attr("aria-describedby")!==t&&i.popover("hide"))}),r.parents(".popover-datetime-range.show").length===0&&n(".popover-datetime-range.show").each(function(){var t=this.getAttribute("id"),i;t&&(i=n('[aria-describedby="'+t+'"]'),r.parents(".datetime-range-bar").attr("aria-describedby")!==t&&i.popover("hide"))}),u=n(i.target),f=u.closest(".popover-datetime"),f.length==1&&(s=f.attr("id"),r=n('[aria-describedby="'+s+'"]'),r.closest(".datetime-picker").hasClass("is-filter")))||(h=u.closest(".table-filter-item"),h.length==0&&n(".table-filter-item.show").each(function(){var t=n(this).data("bb_filter");t.obj.invokeMethodAsync(t.method)}),e=u.closest(".multi-select"),n(".multi-select.show").each(function(){if(e.length===0||this!=e[0]){var t=n(this).data("bb_multi_select");t.obj.invokeMethodAsync(t.method)}}),c=u.closest(".btn-col.init"),c.hasClass("init")||(l=u.closest(".dropdown-menu.dropdown-menu-right.show"),l.length===0&&n(".table-toolbar-button .dropdown-menu.show").removeClass("show")))});n(document).on("click",".popover-confirm-buttons .btn",function(i){var r,u,f;i.stopPropagation();r=t(n(this));r!=null&&(r.popover("hide"),u=r.attr("id"),$ele=n('[data-target="'+u+'"]'),f=this.getAttribute("data-dismiss")==="confirm"?$ele.find(".popover-confirm-buttons .btn:first"):$ele.find(".popover-confirm-buttons .btn:last"),f.trigger("click"))});n(document).on("keyup",function(t){var i;t.key==="Enter"?(i=n(".table-filter .table-filter-item.show:first").data("bb_filter"),i&&i.obj.invokeMethodAsync("ConfirmByKey")):t.key==="Escape"&&(i=n(".table-filter .table-filter-item.show:first").data("bb_filter"),i&&i.obj.invokeMethodAsync("EscByKey"))})})})(jQuery);